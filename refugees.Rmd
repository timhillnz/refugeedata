---
title: "Refugee Data"
author: "Tim Hill"
date: "4 July 2016"
output: html_document
---


```{r, message=F, warning=F}
library(dplyr)
library(ggplot2)
library(scales)
```

The csv file is a combination of three different datasets from the WorldBank, see  github.com/timhillnz/refugeedata/prepareData.R 

## Load prepared data and have a quick look at it - 

```{r}
refdata <- tbl_df(read.csv("./data/refugeeData.csv", na.strings = c("","NA")))
refdata <- select(refdata, -1)
head(refdata)
str(refdata)
```

There are a number of NA's in the Region and Income Group variables.  Let's look at this a bit further - 
```{r}
## How many countries in each region?
refdata %>% group_by(Region)  %>% summarise(number = n_distinct(Country.Name))

## How many countries in each income group?
refdata %>% group_by(IncomeGroup)  %>% summarise(number = n_distinct(Country.Name))

## List the 'countries' with no region
noregions <- as.data.frame(refdata %>% distinct(Country.Name) %>% group_by(Country.Name) %>% filter(is.na(Region))) %>% droplevels()
noregions[,1]
```
 
So the NA's are aggregated data for various groupings.

## First plots - Refugee Data
```{r, warning=F}
### All countries
plotdata1 <- refdata %>% filter(!is.na(Region))
plot1 <- ggplot(plotdata1, aes(x = year, y = numberRefs, colour = Country.Name)) +
  geom_line() + theme(legend.position = "none") + scale_y_log10(labels = comma)
plot1

```

That's a lot - and isn't particularly useful

Let's look at a subset of countries - those shown as High Income: OECD.
```{r, warning = F}
plotdata2 <- refdata %>% filter(IncomeGroup == "High income: OECD") %>% droplevels()
plot2 <- ggplot(plotdata2, aes(x = year, y = numberRefs, colour = Country.Name)) +
  geom_line() + 
  scale_y_log10(labels = comma)
plot2
```

Somewhat better - but there's no standardisation and, with vastly different resident population numbers in those countries, it's not useful to compare raw numbers of refugees.
We'll create a new variable - number of refugees per 10,000 host population.

```{r, warning = F}
## Create the new variable
refdata <- refdata %>% mutate(refugees.per10000popn = numberRefs/(popn/10000))

## Create a dataframe to show only the  OECD countries against the new variable
plotdata3 <- refdata %>% filter(IncomeGroup == "High income: OECD") %>% droplevels()

## Plot the data
plot3 <- ggplot(plotdata3, aes(x = year, y = refugees.per10000popn , colour = Country.Name)) +
  geom_line()  + scale_y_log10(labels = comma)
plot3
```

Still getting better - this time we'll limit the countries even further
```{r, warning = F}
plotdata4 <- refdata %>% filter(Country.Name %in% c("Australia","France","Germany","New Zealand","United Kingdom","United States")) %>% droplevels()

plot4 <- ggplot(plotdata4, aes(x = year, y = refugees.per10000popn , colour = Country.Name)) +
  geom_line()

plot4

```

Much better.

Now we'll look at the data for the OECD and other high income countries for 2014.
```{r}
## Create plot dataset for the selected countries.  Will also add a variable so Australia and NZ can be easily identified
plotdata5 <- refdata %>% 
  filter(year == "2014",IncomeGroup %in% c("High income: nonOECD", "High income: OECD"), 
         !is.na(refugees.per10000popn)) %>% 
  droplevels() %>% 
  mutate(fillcolour = ifelse(Country.Name %in% c("Australia", "New Zealand"), "Colour", NA))

## Reorder the data so the plot shows the countries from highest to lowest
plotdata5$Country.Name <- with(plotdata5, reorder(Country.Name, -refugees.per10000popn, mean))

## Create the plot ...
plot5 <- ggplot(plotdata5, aes(x = Country.Name, y = refugees.per10000popn, fill = fillcolour)) + 
  geom_bar(stat = "identity") + 
  theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5)) +
  theme(legend.position = "none") +
  labs(title = "Number of Refugees per 10,000 population in 2014" )
  
### ... and display it.
plot5

```





